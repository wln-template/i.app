<body class="wln">
    <div class="wln-title">
        <span>
            <input type="text" id="searchkey" onkeydown="ToSearch(event)" placeholder="按回车键进行查找" />
        </span>
        <strong>@Html.Raw(ViewBag.ColumnName)</strong>
        @if (ViewBag.Right_Editer)
        {<a href="articleForm?code=@ViewBag.ColumnCode"><i class="iconfont icon-plug"></i>新增内容</a>}</div>
    <div class="line"></div>
    <table id="dataTable" class="datagrid">
        <tr>
            <td style="width:38px; text-align:center;" field="RowIndex">序号</td>
            <td style="width:58px; text-align:center;" field="ImageUrl">图片</td>
            <td style="width:258px;text-align:left;" field="Title">内容标题</td>
            <td style="width:58px; text-align:center;" function="Weight">置顶</td>
            <td style="width:68px; text-align:center;" field="PublishUser">发布人</td>
            <td style="width:98px; text-align:center;" field="PublishTime">发布时间</td>
            <td style="width:68px; text-align:center;" field="VerifyUser">审核人</td>
            <td style="width:58px; text-align:center;" function="Status">状态</td>
            <td style="width:128px;" function="onAction">操作</td>
        </tr>
    </table>
</body>
<script type="text/javascript">
    var table = control.datagrid('dataTable', 'content?do=list&code=@ViewBag.ColumnCode', 10);
    function ToSearch(e) {
        if (e.keyCode == 13) {
            table.pageIndex = 1;
            table.load({ key: $('#searchkey').val() })
        }
    }
    table.Status = function (e) {
        if (e.Status == '驳回') {
            return '<font style="color:#FF0000">' + e.Status + '</font>';
        } else if (e.Status == '已审') {
            return '<font style="color:#7DB72F">' + e.Status + '</font>';
        } else {
            return '<font style="color:#999999">' + e.Status + '</font>';
        }
    }
    table.Weight = function (e) {
        if (e.Weight > 0) {
            return '<a onclick="Ontop(\'' + e.Id + '\')" title="点击取消" style="color:#7DB72F;">置顶</a>';
        }
        return '';
    }
    table.ImageUrl = function (e) {
        var str = '';
        if (e.ImageUrl) {
            str = '<img src="' + e.ImageUrl + '" style="max-width:40px;max-height:27px;" />';
        }
        else
        {
            str = '<img src="/img/error.gif" style="max-width:40px;max-height:27px;" />';
        }
        return str;
    }
    table.Title = function (e) {
        return '<a href="preview?Id=' + e.Id + '" target="_blank">' + e.Title + '</a>';
    }
    table.onAction = function (e) {
        var str = '';
        if (e.Status == '编辑中' || e.Status == '驳回') {
            @if (ViewBag.Right_Editer)
            {<text>
            str += '<a href="preview?Id=' + e.Id + '" target="_blank">预览</a>&nbsp;';
            str += '<a onclick="SendTo(\'' + e.Id + '\')">送审</a>&nbsp;';
            str += '<a href="articleForm?code=@ViewBag.ColumnCode&Id=' + e.Id + '">编辑</a>&nbsp;';
            str += '<a onclick="Delete(\'' + e.Id + '\')">删除</a>&nbsp;';
            </text>}
        } else if (e.Status == '送审') {
            @if (ViewBag.Right_Editer)
            {<text>
            str += '<a onclick="Recall(\'' + e.Id + '\')">撤回</a>&nbsp;';
            </text>}
            str += '<a href="preview?Id=' + e.Id + '" target="_blank">预览</a>&nbsp;';
            @if (ViewBag.Right_Verify)
            {<text>
            str += '<a onclick="Return(\'' + e.Id + '\')">驳回</a>&nbsp;';
            str += '<a onclick="Verify(\'' + e.Id + '\')">审核</a>&nbsp;';
            </text>}
        } else {
            str += '<a onclick="Ontop(\'' + e.Id + '\')">置顶</a>&nbsp;';
            @if (ViewBag.Right_Editer)
            {<text>
            str += '<a onclick="Recall(\'' + e.Id + '\')">撤回</a>&nbsp;';
                </text>}
            @if (ViewBag.Right_Verify)
            {<text>
            str += '<a onclick="Return(\'' + e.Id + '\')">驳回</a>&nbsp;';
                </text>}
            @if (ViewBag.Right_Delete)
            {<text>
            str += '<a onclick="Delete(\'' + e.Id + '\')">删除</a>&nbsp;';
                </text>}
        }
        return str;
    }
    function SendTo(Id) {
        control.confirm('确定要送审此内容吗?', '操作确认', function () {
            $.getJSON('content?do=sendto', { Id: Id,code:'@ViewBag.ColumnCode' }, function (json) {
                if (json.success) {
                    control.success(json.message, function () {
                        table.reload();
                    });
                } else {
                    control.error(json.message);
                }
            });
        });
    }
    function Recall(Id) {
        control.confirm('确定要撤回此内容吗?', '操作确认', function () {
            $.getJSON('content?do=recall', { Id: Id }, function (json) {
                if (json.success) {
                    control.success(json.message, function () {
                        table.reload();
                    });
                } else {
                    control.error(json.message);
                }
            });
        });
    }
    function Return(Id) {
        control.confirm('确定要驳回此内容吗?', '操作确认', function () {
            $.getJSON('content?do=return', { Id: Id }, function (json) {
                if (json.success) {
                    control.success(json.message, function () {
                        table.reload();
                    });
                } else {
                    control.error(json.message);
                }
            });
        });
    }
    function Verify(Id) {
        control.confirm('确定要审核此内容吗?', '操作确认', function () {
            $.getJSON('content?do=verify', { Id: Id }, function (json) {
                if (json.success) {
                    control.success(json.message, function () {
                        table.reload();
                    });
                } else {
                    control.error(json.message);
                }
            });
        });
    }
    function Delete(Id) {
        control.confirm('确定要删除此内容吗?', '操作确认', function () {
            $.getJSON('content?do=delete', { Id: Id }, function (json) {
                if (json.success) {
                    control.success(json.message, function () {
                        table.reload();
                    });
                } else {
                    control.error(json.message);
                }
            });
        });
    }
    function Ontop(Id) {
        control.confirm('确定要置顶/取消此内容吗?', '操作确认', function () {
            $.getJSON('content?do=ontop', { Id: Id }, function (json) {
                if (json.success) {
                    table.reload();
                } else {
                    control.error(json.message);
                }
            });
        });
    }
</script>